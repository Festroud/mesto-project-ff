(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){if("Escape"===e.key){var n=document.querySelector(".popup_is-opened");n&&t(n)}}function r(e,t,n){var r=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function o(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));!function(e,t,n){t?(e.classList.add(n.disabledButtonClass),e.disabled=!0):(e.classList.remove(n.disabledButtonClass),e.disabled=!1)}(e.querySelector(t.submitButtonSelector),n.some((function(e){return!e.validity.valid})),t)}function c(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){r(e,n,t)})),o(e,t)}var u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-23",headers:{authorization:"0e3cc8b0-02a1-45cf-83f4-1d07ae6ce22f","Content-Type":"application/json"}},a=function(e){return fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return console.log("Delete response status: ".concat(e.status)),e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},i=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},s=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},l=document.querySelector(".places__list"),d=document.querySelector(".popup_type_image"),p=d.querySelector(".popup__image"),f=d.querySelector(".popup__caption"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),h=document.querySelector('.popup__form[name="edit-profile"]'),S=h.querySelector(".popup__input_type_name"),b=h.querySelector(".popup__input_type_description"),q=document.querySelector('.popup__form[name="new-place"]'),k=q.querySelector(".popup__input_type_card-name"),E=q.querySelector(".popup__input_type_url"),L=document.querySelector('.popup__form[name="edit-avatar"]'),C=L.querySelector(".popup__input_type_url"),g=document.querySelectorAll(".popup"),j=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),P=document.querySelector(".popup_type_edit-avatar"),A=document.querySelector(".profile__image"),U=null,D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",disabledButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},T=function(e){var t=document.querySelector(".popup_is-opened");if(t){var n=t.querySelector(".popup__button");n.disabled=e,n.textContent=e?"Сохранение...":"Сохранить"}};function w(t){var n=t.target.src,r=t.target.alt;p.src=n,p.alt=r,f.textContent=r,e(d)}function B(e,t){confirm("Вы уверены, что хотите удалить эту карточку?")&&a(e).then((function(){var e=t.target.closest(".card");e&&e.remove()})).catch((function(e){return console.error("Ошибка: ".concat(e))}))}function N(e,t,n,r){r?s(e).then((function(e){n(e.likes)})).catch((function(e){return console.error(e)})):i(e).then((function(e){n(e.likes)})).catch((function(e){return console.error(e)}))}function O(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e,t,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__image"),a=c.querySelector(".card__title"),i=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-count"),l=c.querySelector(".card__delete-button");u.src=e.link,u.alt=e.name,a.textContent=e.name,s.textContent=e.likes.length,e.likes.some((function(e){return e._id===o}))&&i.classList.add("card__like-button_is-active");var d=function(t){e.likes=t,s.textContent=t.length,t.some((function(e){return e._id===o}))?i.classList.add("card__like-button_is-active"):i.classList.remove("card__like-button_is-active")};return u.addEventListener("click",t),i.addEventListener("click",(function(t){var r=i.classList.contains("card__like-button_is-active");n(e._id,t,d,r)})),e.owner._id===o?l.addEventListener("click",(function(t){return r(e._id,t)})):l.remove(),c}(e,w,N,B,U);t?l.prepend(n):l.append(n)}_.addEventListener("click",(function(){S.value=y.textContent,b.value=v.textContent,e(j),c(h,D)})),m.addEventListener("click",(function(){e(x),c(q,D)})),A.addEventListener("click",(function(){e(P),c(L,D)})),function(e){e.forEach((function(e){var n=e.querySelector(".popup__close");n&&n.addEventListener("click",(function(){t(e)})),e.addEventListener("click",(function(n){n.target===e&&t(e)}))}))}(g),h.addEventListener("submit",(function(e){var n,r;e.preventDefault(),T(!0),(n=S.value,r=b.value,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){y.textContent=e.name,v.textContent=e.about,t(j)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return T(!1)}))})),q.addEventListener("submit",(function(e){var n,r;e.preventDefault(),T(!0),(n=k.value,r=E.value,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){O(e,!0),t(x),q.reset(),c(q,D)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return T(!1)}))})),L.addEventListener("submit",(function(e){var n;e.preventDefault(),T(!0),(n=C.value,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){A.style.backgroundImage="url('".concat(e.avatar,"')"),t(P),L.reset(),c(L,D)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return T(!1)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.error):t.setCustomValidity(""),t.validity.valid?r(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-input-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n),o(e,n)}(e,n,t)}))})),o(e,t)}(t,e)}))}(D),fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){y.textContent=e.name,v.textContent=e.about,A.style.backgroundImage="url('".concat(e.avatar,"')"),U=e._id})).then((function(){return fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})).then((function(e){e.forEach((function(e){return O(e)}))})).catch((function(e){return console.error(e)}))})();